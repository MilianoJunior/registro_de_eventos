<div class="incidentes-carousel">
    <button class="carousel-nav carousel-nav-prev" aria-label="Incidente anterior">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M12 11L8 7L12 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>
    
    <div class="incidentes-carousel-container">
        <div class="incidentes-carousel-track">
            <div class="incidente-item">
                <div class="incidente-header">
                    <div class="incidente-icon priority-media">!</div>
                    <div class="incidente-content">
                        <div class="incidente-title">Usina Gamma - Automação/Comms</div>
                        <div class="incidente-description">Perda de comunicação com remota do vertedouro</div>
                        <div class="incidente-meta">26/09/2025, 13:17:37 por Sistema SCADA</div>
                    </div>
                </div>
                <div class="incidente-button-container">
                    <div class="incidente-priority priority-media">Média</div>
                    <button class="btn">Encerrar com relatorio</button>
                </div>
            </div>

            <div class="incidente-item">
                <div class="incidente-header">
                    <div class="incidente-icon priority-alta">!</div>
                    <div class="incidente-content">
                        <div class="incidente-title">Usina Alpha - Equipamento</div>
                        <div class="incidente-description">Temperatura elevada no gerador 2</div>
                        <div class="incidente-meta">26/09/2025, 14:22:15 por Sistema SCADA</div>
                    </div>
                </div>
                <div class="incidente-button-container">
                    <div class="incidente-priority priority-alta">Alta</div>
                    <button class="btn">Encerrar com relatorio</button>
                </div>
            </div>

            <div class="incidente-item">
                <div class="incidente-header">
                    <div class="incidente-icon priority-baixa">!</div>
                    <div class="incidente-content">
                        <div class="incidente-title">Usina Beta - Manutenção</div>
                        <div class="incidente-description">Manutenção preventiva programada</div>
                        <div class="incidente-meta">26/09/2025, 15:00:00 por Operador</div>
                    </div>
                </div>
                <div class="incidente-button-container">
                    <div class="incidente-priority priority-baixa">Baixa</div>
                    <button class="btn">Encerrar com relatorio</button>
                </div>
            </div>
            <div class="incidente-item">
                <div class="incidente-header">
                    <div class="incidente-icon priority-alta">!</div>
                    <div class="incidente-content">
                        <div class="incidente-title">Usina Alpha - Equipamento</div>
                        <div class="incidente-description">Temperatura elevada no gerador 2</div>
                        <div class="incidente-meta">26/09/2025, 14:22:15 por Sistema SCADA</div>
                    </div>
                </div>
                <div class="incidente-button-container">
                    <div class="incidente-priority priority-alta">Alta</div>
                    <button class="btn">Encerrar com relatorio</button>
                </div>
            </div>
        </div>
    </div>

    <button class="carousel-nav carousel-nav-next" aria-label="Próximo incidente">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M4 3L8 7L4 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>
</div>

<script>
(function() {
    const carousel = document.querySelector('.incidentes-carousel');
    const track = document.querySelector('.incidentes-carousel-track');
    const items = document.querySelectorAll('.incidente-item');
    const prevBtn = document.querySelector('.carousel-nav-prev');
    const nextBtn = document.querySelector('.carousel-nav-next');
    
    let currentIndex = 0;
    let autoPlayInterval;
    const autoPlayDelay = 2000; // 5 segundos

    function updateCarousel(transition = true) {
        if (!transition) {
            track.style.transition = 'none';
        } else {
            track.style.transition = 'transform 0.5s ease-in-out';
        }
        
        // Calcular a posição para centralizar o item ativo
        const containerHeight = carousel.querySelector('.incidentes-carousel-container').offsetHeight;
        const currentItem = items[currentIndex];
        const itemHeight = currentItem.offsetHeight;
        const gap = 10; // gap entre items (deve corresponder ao gap do CSS)
        
        // Calcular posição: deslocamento total até o item atual - metade do container + metade do item
        const offset = (currentIndex * (itemHeight + gap)) - ((containerHeight - itemHeight) / 2);
        
        track.style.transform = `translateY(-${offset}px)`;
        
        // Atualizar classes dos cards para efeito de foco
        items.forEach((item, index) => {
            item.classList.remove('active', 'inactive');
            if (index === currentIndex) {
                item.classList.add('active');
            } else {
                item.classList.add('inactive');
            }
        });
        
        // Restaurar transição após um frame
        if (!transition) {
            requestAnimationFrame(() => {
                track.style.transition = 'transform 0.5s ease-in-out';
            });
        }
    }

    function nextSlide() {
        currentIndex = (currentIndex + 1) % items.length;
        updateCarousel();
    }

    function prevSlide() {
        currentIndex = (currentIndex - 1 + items.length) % items.length;
        updateCarousel();
    }

    function startAutoPlay() {
        stopAutoPlay(); // Limpar qualquer interval existente
        autoPlayInterval = setInterval(nextSlide, autoPlayDelay);
    }

    function stopAutoPlay() {
        if (autoPlayInterval) {
            clearInterval(autoPlayInterval);
            autoPlayInterval = null;
        }
    }

    // Event listeners
    if (prevBtn) {
        prevBtn.addEventListener('click', () => {
            prevSlide();
            stopAutoPlay();
            startAutoPlay(); // Reiniciar após interação manual
        });
    }

    if (nextBtn) {
        nextBtn.addEventListener('click', () => {
            nextSlide();
            stopAutoPlay();
            startAutoPlay(); // Reiniciar após interação manual
        });
    }

    // Parar autoplay quando o mouse estiver sobre o carrossel
    if (carousel) {
        carousel.addEventListener('mouseenter', stopAutoPlay);
        carousel.addEventListener('mouseleave', startAutoPlay);
    }

    // Recalcular posição em resize
    let resizeTimeout;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
            updateCarousel(false);
        }, 150);
    });

    // Iniciar autoplay
    if (items.length > 1) {
        startAutoPlay();
    }

    // Inicializar posição após o DOM estar pronto
    setTimeout(() => {
        updateCarousel(false);
    }, 100);
})();
</script>
