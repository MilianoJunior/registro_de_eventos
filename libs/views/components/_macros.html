{% macro card(title, with_css=False) -%}
  {% if with_css %}
  <style>
    [data-c="card"] { 
      background: var(--color-bg-alt); 
      border: 1px solid var(--color-stroke); 
      border-radius: var(--radius-lg); 
      padding: var(--space-4); 
      box-shadow: var(--shadow-sm); 
    }
    [data-c="card"] .title { 
      font-weight: var(--font-weight-medium); 
      margin-bottom: var(--space-2); 
      color: var(--color-text);
      font-size: var(--font-size-lg);
    }
    [data-c="card"] .body { 
      font-size: var(--font-size-sm); 
      color: var(--color-text-muted); 
    }
    .chips { 
      display: flex; 
      flex-wrap: wrap; 
      gap: var(--space-2); 
      margin-top: var(--space-2); 
    }
    .chip { 
      padding: var(--space-1) var(--space-2); 
      border-radius: var(--radius-full); 
      background: var(--green-b); 
      font-size: var(--font-size-xs); 
      color: var(--color-text-inv);
      font-weight: var(--font-weight-medium);
    }
    .list-compact { 
      list-style: none; 
      display: grid; 
      gap: var(--space-2); 
      margin-top: var(--space-2); 
      padding: 0; 
    }
    .muted { 
      color: var(--color-text-muted); 
      font-size: var(--font-size-xs); 
    }
    table.clean { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: var(--space-2); 
    }
    table.clean td { 
      padding: var(--space-2) 0; 
      border-bottom: 1px dashed var(--color-stroke); 
    }
    table.clean td:last-child { 
      text-align: right; 
      font-weight: var(--font-weight-medium); 
    }
  </style>
  {% endif %}
  <div data-c="card">
    <div class="title">{{ title }}</div>
    <div class="body">
      {{ caller() }}
    </div>
  </div>
{%- endmacro %}

{% macro button(text, variant="primary", size="md", type="button", disabled=false, with_css=False) -%}
  {% if with_css %}
  <style>
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      border: none;
      border-radius: var(--radius-md);
      font-family: var(--font-family-base);
      font-weight: var(--font-weight-medium);
      text-decoration: none;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* Sizes */
    .btn-sm {
      padding: var(--space-1) var(--space-3);
      font-size: var(--font-size-sm);
    }
    .btn-md {
      padding: var(--space-2) var(--space-4);
      font-size: var(--font-size-md);
    }
    .btn-lg {
      padding: var(--space-3) var(--space-6);
      font-size: var(--font-size-lg);
    }
    
    /* Variants */
    .btn-primary {
      background: var(--color-accent);
      color: white;
    }
    .btn-primary:hover:not(:disabled) {
      background: #2563eb;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-success {
      background: var(--color-success);
      color: white;
    }
    .btn-success:hover:not(:disabled) {
      background: #16a34a;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-warning {
      background: var(--color-warning);
      color: var(--color-text-inv);
    }
    .btn-warning:hover:not(:disabled) {
      background: #ca8a04;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-danger {
      background: var(--color-danger);
      color: white;
    }
    .btn-danger:hover:not(:disabled) {
      background: #dc2626;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-secondary {
      background: var(--color-surface);
      color: var(--color-text);
      border: 1px solid var(--color-stroke);
    }
    .btn-secondary:hover:not(:disabled) {
      background: var(--color-bg-alt);
      box-shadow: var(--shadow-sm);
    }
  </style>
  {% endif %}
  <button class="btn btn-{{ variant }} btn-{{ size }}" type="{{ type }}" {% if disabled %}disabled{% endif %}>
    {{ text }}
  </button>
{%- endmacro %}

{% macro input(label, name, type="text", placeholder="", value="", required=false, with_css=False) -%}
  {% if with_css %}
  <style>
    .form-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-1);
      margin-bottom: var(--space-4);
    }
    .form-label {
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      color: var(--color-text);
    }
    .form-input {
      padding: var(--space-2) var(--space-3);
      border: 1px solid var(--color-stroke);
      border-radius: var(--radius-md);
      background: var(--color-bg-alt);
      color: var(--color-text);
      font-family: var(--font-family-base);
      font-size: var(--font-size-md);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .form-input:focus {
      outline: none;
      border-color: var(--color-accent);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .form-input::placeholder {
      color: var(--color-text-muted);
    }
  </style>
  {% endif %}
  <div class="form-group">
    {% if label %}
      <label class="form-label" for="{{ name }}">{{ label }}</label>
    {% endif %}
    <input 
      class="form-input" 
      type="{{ type }}" 
      name="{{ name }}" 
      id="{{ name }}"
      placeholder="{{ placeholder }}"
      value="{{ value }}"
      {% if required %}required{% endif %}
    >
  </div>
{%- endmacro %}
